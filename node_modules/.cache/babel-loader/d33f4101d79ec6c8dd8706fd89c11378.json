{"ast":null,"code":"var _jsxFileName = \"/Users/gsg/Documents/3d/react-demo/demo/src/3d/Rig.js\";\nimport React, { useRef } from 'react';\nimport { useThree, useFrame } from 'react-three-fiber';\nimport useStore from '../store';\nvar offset = 0;\nexport default function Rig(_ref) {\n  var children = _ref.children;\n  var group = useRef();\n  var rig = useRef();\n  var mutation = useStore(function (state) {\n    return state.mutation;\n  });\n  var fov = mutation.fov,\n      scale = mutation.scale,\n      binormal = mutation.binormal,\n      normal = mutation.normal,\n      track = mutation.track,\n      mouse = mutation.mouse;\n\n  var _useThree = useThree(),\n      camera = _useThree.camera;\n\n  useFrame(function () {\n    var t = mutation.t;\n    var pos = mutation.position.clone();\n    var segments = track.tangents.length;\n    var pickt = t * segments;\n    var pick = Math.floor(pickt);\n    var pickNext = (pick + 1) % segments;\n    binormal.subVectors(track.binormals[pickNext], track.binormals[pick]);\n    binormal.multiplyScalar(pickt - pick).add(track.binormals[pick]);\n    var dir = track.parameters.path.getTangentAt(t);\n    offset += (Math.max(15, 15 + -mouse.y / 20) - offset) * 0.05;\n    normal.copy(binormal).cross(dir);\n    pos.add(normal.clone().multiplyScalar(offset));\n    camera.position.copy(pos);\n    var lookAt = track.parameters.path.getPointAt((t + 30 / track.parameters.path.getLength()) % 1).multiplyScalar(scale);\n    camera.matrix.lookAt(camera.position, lookAt, normal);\n    camera.quaternion.setFromRotationMatrix(camera.matrix);\n    camera.fov += ((t > 0.4 && t < 0.45 ? 120 : fov) - camera.fov) * 0.05;\n    camera.updateProjectionMatrix();\n    var lightPos = track.parameters.path.getPointAt((t + 1 / track.parameters.path.getLength()) % 1).multiplyScalar(scale);\n    group.current.position.copy(lightPos);\n    group.current.quaternion.setFromRotationMatrix(camera.matrix);\n  });\n  return /*#__PURE__*/React.createElement(\"group\", {\n    ref: group,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 38,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"pointLight\", {\n    distance: 400,\n    position: [0, 100, -420],\n    intensity: 5,\n    color: \"indianred\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 39,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"group\", {\n    ref: rig,\n    position: [0, 0, -50],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 13\n    }\n  }, children));\n}","map":{"version":3,"sources":["/Users/gsg/Documents/3d/react-demo/demo/src/3d/Rig.js"],"names":["React","useRef","useThree","useFrame","useStore","offset","Rig","children","group","rig","mutation","state","fov","scale","binormal","normal","track","mouse","camera","t","pos","position","clone","segments","tangents","length","pickt","pick","Math","floor","pickNext","subVectors","binormals","multiplyScalar","add","dir","parameters","path","getTangentAt","max","y","copy","cross","lookAt","getPointAt","getLength","matrix","quaternion","setFromRotationMatrix","updateProjectionMatrix","lightPos","current"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,MAAhB,QAA8B,OAA9B;AACA,SAASC,QAAT,EAAmBC,QAAnB,QAAmC,mBAAnC;AACA,OAAOC,QAAP,MAAqB,UAArB;AAEA,IAAIC,MAAM,GAAG,CAAb;AACA,eAAe,SAASC,GAAT,OAA2B;AAAA,MAAZC,QAAY,QAAZA,QAAY;AACtC,MAAMC,KAAK,GAAGP,MAAM,EAApB;AACA,MAAMQ,GAAG,GAAGR,MAAM,EAAlB;AACA,MAAMS,QAAQ,GAAGN,QAAQ,CAAC,UAAAO,KAAK;AAAA,WAAIA,KAAK,CAACD,QAAV;AAAA,GAAN,CAAzB;AAHsC,MAI9BE,GAJ8B,GAIiBF,QAJjB,CAI9BE,GAJ8B;AAAA,MAIzBC,KAJyB,GAIiBH,QAJjB,CAIzBG,KAJyB;AAAA,MAIlBC,QAJkB,GAIiBJ,QAJjB,CAIlBI,QAJkB;AAAA,MAIRC,MAJQ,GAIiBL,QAJjB,CAIRK,MAJQ;AAAA,MAIAC,KAJA,GAIiBN,QAJjB,CAIAM,KAJA;AAAA,MAIOC,KAJP,GAIiBP,QAJjB,CAIOO,KAJP;;AAAA,kBAKnBf,QAAQ,EALW;AAAA,MAK9BgB,MAL8B,aAK9BA,MAL8B;;AAOtCf,EAAAA,QAAQ,CAAC,YAAM;AACX,QAAMgB,CAAC,GAAGT,QAAQ,CAACS,CAAnB;AACA,QAAMC,GAAG,GAAGV,QAAQ,CAACW,QAAT,CAAkBC,KAAlB,EAAZ;AACA,QAAMC,QAAQ,GAAGP,KAAK,CAACQ,QAAN,CAAeC,MAAhC;AACA,QAAMC,KAAK,GAAGP,CAAC,GAAGI,QAAlB;AACA,QAAMI,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWH,KAAX,CAAb;AACA,QAAMI,QAAQ,GAAG,CAACH,IAAI,GAAG,CAAR,IAAaJ,QAA9B;AACAT,IAAAA,QAAQ,CAACiB,UAAT,CAAoBf,KAAK,CAACgB,SAAN,CAAgBF,QAAhB,CAApB,EAA+Cd,KAAK,CAACgB,SAAN,CAAgBL,IAAhB,CAA/C;AACAb,IAAAA,QAAQ,CAACmB,cAAT,CAAwBP,KAAK,GAAGC,IAAhC,EAAsCO,GAAtC,CAA0ClB,KAAK,CAACgB,SAAN,CAAgBL,IAAhB,CAA1C;AACA,QAAMQ,GAAG,GAAGnB,KAAK,CAACoB,UAAN,CAAiBC,IAAjB,CAAsBC,YAAtB,CAAmCnB,CAAnC,CAAZ;AACAd,IAAAA,MAAM,IAAI,CAACuB,IAAI,CAACW,GAAL,CAAS,EAAT,EAAa,KAAK,CAACtB,KAAK,CAACuB,CAAP,GAAW,EAA7B,IAAmCnC,MAApC,IAA8C,IAAxD;AACAU,IAAAA,MAAM,CAAC0B,IAAP,CAAY3B,QAAZ,EAAsB4B,KAAtB,CAA4BP,GAA5B;AACAf,IAAAA,GAAG,CAACc,GAAJ,CAAQnB,MAAM,CAACO,KAAP,GAAeW,cAAf,CAA8B5B,MAA9B,CAAR;AACAa,IAAAA,MAAM,CAACG,QAAP,CAAgBoB,IAAhB,CAAqBrB,GAArB;AACA,QAAMuB,MAAM,GAAG3B,KAAK,CAACoB,UAAN,CAAiBC,IAAjB,CAAsBO,UAAtB,CAAiC,CAACzB,CAAC,GAAG,KAAKH,KAAK,CAACoB,UAAN,CAAiBC,IAAjB,CAAsBQ,SAAtB,EAAV,IAA+C,CAAhF,EAAmFZ,cAAnF,CAAkGpB,KAAlG,CAAf;AACAK,IAAAA,MAAM,CAAC4B,MAAP,CAAcH,MAAd,CAAqBzB,MAAM,CAACG,QAA5B,EAAsCsB,MAAtC,EAA8C5B,MAA9C;AACAG,IAAAA,MAAM,CAAC6B,UAAP,CAAkBC,qBAAlB,CAAwC9B,MAAM,CAAC4B,MAA/C;AACA5B,IAAAA,MAAM,CAACN,GAAP,IAAc,CAAC,CAACO,CAAC,GAAG,GAAJ,IAAWA,CAAC,GAAG,IAAf,GAAsB,GAAtB,GAA4BP,GAA7B,IAAoCM,MAAM,CAACN,GAA5C,IAAmD,IAAjE;AACAM,IAAAA,MAAM,CAAC+B,sBAAP;AACA,QAAMC,QAAQ,GAAGlC,KAAK,CAACoB,UAAN,CAAiBC,IAAjB,CAAsBO,UAAtB,CAAiC,CAACzB,CAAC,GAAG,IAAIH,KAAK,CAACoB,UAAN,CAAiBC,IAAjB,CAAsBQ,SAAtB,EAAT,IAA8C,CAA/E,EAAkFZ,cAAlF,CAAiGpB,KAAjG,CAAjB;AACAL,IAAAA,KAAK,CAAC2C,OAAN,CAAc9B,QAAd,CAAuBoB,IAAvB,CAA4BS,QAA5B;AACA1C,IAAAA,KAAK,CAAC2C,OAAN,CAAcJ,UAAd,CAAyBC,qBAAzB,CAA+C9B,MAAM,CAAC4B,MAAtD;AACH,GAtBO,CAAR;AAwBA,sBACI;AAAO,IAAA,GAAG,EAAEtC,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAY,IAAA,QAAQ,EAAE,GAAtB;AAA2B,IAAA,QAAQ,EAAE,CAAC,CAAD,EAAI,GAAJ,EAAS,CAAC,GAAV,CAArC;AAAqD,IAAA,SAAS,EAAE,CAAhE;AAAmE,IAAA,KAAK,EAAC,WAAzE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,eAEI;AAAO,IAAA,GAAG,EAAEC,GAAZ;AAAiB,IAAA,QAAQ,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAC,EAAR,CAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACKF,QADL,CAFJ,CADJ;AAQH","sourcesContent":["import React, { useRef } from 'react'\nimport { useThree, useFrame } from 'react-three-fiber'\nimport useStore from '../store'\n\nlet offset = 0\nexport default function Rig({ children }) {\n    const group = useRef()\n    const rig = useRef()\n    const mutation = useStore(state => state.mutation)\n    const { fov, scale, binormal, normal, track, mouse } = mutation\n    const { camera } = useThree()\n\n    useFrame(() => {\n        const t = mutation.t\n        const pos = mutation.position.clone()\n        const segments = track.tangents.length\n        const pickt = t * segments\n        const pick = Math.floor(pickt)\n        const pickNext = (pick + 1) % segments\n        binormal.subVectors(track.binormals[pickNext], track.binormals[pick])\n        binormal.multiplyScalar(pickt - pick).add(track.binormals[pick])\n        const dir = track.parameters.path.getTangentAt(t)\n        offset += (Math.max(15, 15 + -mouse.y / 20) - offset) * 0.05\n        normal.copy(binormal).cross(dir)\n        pos.add(normal.clone().multiplyScalar(offset))\n        camera.position.copy(pos)\n        const lookAt = track.parameters.path.getPointAt((t + 30 / track.parameters.path.getLength()) % 1).multiplyScalar(scale)\n        camera.matrix.lookAt(camera.position, lookAt, normal)\n        camera.quaternion.setFromRotationMatrix(camera.matrix)\n        camera.fov += ((t > 0.4 && t < 0.45 ? 120 : fov) - camera.fov) * 0.05\n        camera.updateProjectionMatrix()\n        const lightPos = track.parameters.path.getPointAt((t + 1 / track.parameters.path.getLength()) % 1).multiplyScalar(scale)\n        group.current.position.copy(lightPos)\n        group.current.quaternion.setFromRotationMatrix(camera.matrix)\n    })\n\n    return (\n        <group ref={group}>\n            <pointLight distance={400} position={[0, 100, -420]} intensity={5} color=\"indianred\" />\n            <group ref={rig} position={[0, 0, -50]}>\n                {children}\n            </group>\n        </group>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}